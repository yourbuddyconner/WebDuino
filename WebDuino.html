<head>
  <title>WebDuino</title>
  <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
  <script src="http://code.highcharts.com/modules/exporting.js"></script>
  <script type="text/javascript">
	 //  	function addSensor () {
	 //  		var sensorName = $('#sensorName').val();
	 //  		var sensorType = $('#sensorType').val();
	 // 	 	var pins = $("#pins").val();
	 //  		console.log("stuff")
	 //  		$('#sensorTable').prepend("<tr><td>" + sensorName + "</td><td>" + sensorType + "</td><td>" + pins + "</td>");
		// }

	</script>
</head>

<body>
	<div id="container">
		{{> header}}
		{{#if currentUser}}
			{{> projects}}
		{{else}}
			{{> home}}
		{{/if}}
	</div>
	
</body>

<template name="home">
  <h1>Welcome to Webduino!</h1>
  <br>
  
  <h3>What is Webduino?</h3>
  <p>Webduino is a web service that provides you with the capability of connecting your arduino to the internet and storing the data on our database with relative ease.</p>

  <h3>Why Webduino?</h3>
  <p>The great part about Webduino is it gives you all of the web capabilities without the need to write any unnecessary server code.</p>

  <h3>How it works?</h3>
  <p>Users create projects that contain sensors recognized by Webduino and it then generates arduino code that can be directly placed into you projects. The code sends you data to our web server that is then stored and can be read at any time within the web interface.</p>
</template>

<template name="header">
	<div id="header">
		{{> loginButtons}}
	</div>
</template>

<template name="projects">
	<div id="your_projects" class="clearfix">
		<h1 style="float: left;" class="">Your Projects</h1>
		<button data-toggle="collapse" href="#addSensor">Add Project</button>
	</div>
	{{> createProject}}
	<div class="panel-group" id="accordion">
		{{#each projects}}
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#{{_id}}">{{name}}</a>
					</h3>
				</div>
				<div id="{{_id}}" class="panel-collapse collapse">
					<div class="panel-body 1indent">
						<h4>Sensors: </h4>
							{{#each sensors parent=_id}}
								<h5 class="2indent"><a data-toggle="collapse" href="#{{_id}}">{{name}}</a></h5>
								<div id="{{_id}}" class="panel-collapse collapse">
									<p class="3indent">Sensor Type: {{sensorType}}</p>
									<p class="3indent">Pins: {{pin}}</p>
									<p class="3indent">Last Recieved Data: (TODO)</p>
									<p class="3indent"><a data-toggle="collapse" href="#{{_id}}_data">Data</a></p>
									<div id="{{_id}}_data" class="panel-collapse collapse">
										{{> graph parentId="yolo"}}
									</div>
								</div>
							{{/each}}
							<table id="sensorTable">
								<tr class="control-group" id="sensor_form_{{_id}}">
									<td><input type="text" name="sensorName" id="sensor_form_name_{{_id}}" placeholder="Sensor Name"></td>
										<td>
											<select class="form-control" id="sensor_form_type_{{_id}}" name="sensorType">
											<option>Potentiometer</option>
											<option>Accelerometer</option>
											</select>
										</td>
									<td>
										<input type="text" name="pins" id="sensor_form_pins_{{_id}}" placeholder="Pins (Ex. 1 2 3)">
									</td>
									<td>
										<span id={{_id}}>
											<button id="add_sensor_{{_id}}">Add Sensor</button>
										</span>
									</td>
								</tr>
							</table>
					</div>
				</div>
			</div>
		{{/each}}
	</div>
</template>

<template name="createProject">
	<div id="addSensor" class="panel-collapse collapse control-group">
		<form class="form-horizontal">
   			<div class="control-group span6">
      		<label class="control-label" for="project_name">Please input a project name: </label>
	      		<div class="controls">
	        		<input type="text" id="project_name" placeholder="Project Name">
	      		</div>
    		</div>
    		<button id="check_name">Check Name</button>
    	</form>

<!-- 		<input type="text" name="projectName" id="project_name" class="span6" placeholder="Project Name">  
		<button id="check_name">Check Name</button> -->

<!-- 		<table id="sensorTable">
			<tr>
				<td><input type="text" name="sensorName" id="sensorName" placeholder="Sensor Name"></td>
				<td><select class="form-control" id="sensorType" name="sensorType">
					<option>Potentiometer</option>
					<option>Accelerometer</option>
				</select></td>
				<td><input type="text" name="pins" id="pins" placeholder="Pins (Ex. 1 2 3)"></td>
				<td><button onclick="addSensor()">Add Sensor</button></td>
			</tr>
			{{#each sensorArray}}
			<tr>
				<td>{{sensorName}}</td><td>{{sensorType}}</td><td>sensorPins</td>
			</tr>
			{{/each}}
		</table> -->
	</div>
</template>

<template name="graph">
	<script>
	    $('#{{_id}}_data').highcharts({
	        chart: {
	            type: 'line'
	        },
	        title: {
	            text: 'Sensor Data'
	        },
	        subtitle: {
	            text: 'Subtitle'
	        },
	        yAxis: {
	            title: {
	                text: 'Sensor Value'
	            }
	        },
	        plotOptions: {
	            line: {
	                dataLabels: {
	                    enabled: true
	                },
	                enableMouseTracking: false
	            }
	        },
	        series: [{
	            name: 'Sensor Name Here',
	            data: {{data}}
	        }]
	    });
	</script>
</template>