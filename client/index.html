
<head>
  <title>WebDuino</title>
  <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
  <script src="http://code.highcharts.com/modules/exporting.js"></script>
  <script>

  </script>
</head>

<body>
	<div id="container">
		{{> header}}
		{{#if currentUser}}
			{{> projects}}
		{{else}}
			{{> home}}
		{{/if}}
	</div>
</body>

<template name="header">
	<div id="header">
		{{> loginButtons}}
	</div>
</template>

<template name="home">
  <h1>Welcome to Webduino!</h1>
  <br>
  
  <h3>What is Webduino?</h3>
  <p>Webduino is a web service that provides you with the capability of connecting your arduino to the internet and storing the data on our database with relative ease.</p>

  <h3>Why Webduino?</h3>
  <p>The great part about Webduino is it gives you all of the web capabilities without the need to write any unnecessary server code.</p>

  <h3>How it works?</h3>
  <p>Users create projects that contain sensors recognized by Webduino and it then generates arduino code that can be directly placed into you projects. The code sends you data to our web server that is then stored and can be read at any time within the web interface.</p>
</template>

<template name="projects">
	<h3>Your Projects</h3>
	{{! Iterate over all the projects that a user owns}}
	{{#each projects}}
	<div class="projectContainer">
		<a class="projectLabel">{{name}}</a>
		<div class="project collapse">
			<div class="well" data-id="{{_id}}">
					{{#each sensors}}
						<p>{{name}}</p>
						<p>{{type}}</p>
					{{/each}}
			</div>
		</div>
	</div>	
	{{/each}}

	{{#autoForm schema=projectFormSchema id="insertProjectForm" type="method" meteormethod="insertProject"}}
		<fieldset>
			{{> afQuickField name="name"}}
		</fieldset>
		<button type="submit" class="btn btn-primary">Insert</button>
	{{/autoForm}}
</template>

<template name="projects-old">
	<div id="your_projects" class="clearfix">
		<h1 style="float: left;" class="">Your Projects</h1>
		<button data-toggle="collapse" href="#addSensor" class="btn btn-default">Add Project</button>
	</div>
	{{> createProject}}
	<div class="panel-group" id="accordion">
		{{#each projects}}
			<div class="panel panel-default project">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#{{_id}}">{{name}}</a>
					</h3>
				</div>
				
				<div id="{{_id}}" class="panel-collapse collapse">
					<div class="panel-body 1indent">
						<h4>Sensors: </h4>
						{{#each sensors parent=_id}}
						<div class="well">
							<h5 class="2indent"><a data-toggle="collapse" href="#{{_id}}">{{name}}</a></h5>
							<div id="{{_id}}" class="panel-collapse collapse">
								<p class="3indent">Sensor Type: {{sensorType}}</p>
								<p class="3indent">Pins: {{pins}}</p>
								<!-- <p class="3indent">Last Recieved Data: (TODO)</p> -->
								<p class="3indent"><a data-toggle="collapse" href="#{{_id}}_data">Data</a></p>
								<div id="{{_id}}_data" class="panel-collapse collapse">
									<div id="{{_id}}_graph" style="width:100%; height:400px;"></div>
										<script type="text/javascript">
											$(function () { 
												var readings = Readings.find({parentId: '{{_id}}'}).fetch();
												var newArray = [];
												//console.log(readings);
												$.each(readings, function (index, value) {
													//console.log(value.data)
													newVal = parseInt(value.data)
													if (!isNaN(newVal))
														newArray[index] = newVal;
												});
												console.log(newArray);
											    $('#{{_id}}_graph').highcharts({
											        chart: {
											            type: 'line'
											        },
											        title: {
											            text: 'Data Recieved'
											        },
											        series: [{
											            name: '{{name}}',
											            data: newArray
											        }, 
											       	]
											    });
											});
										</script>
								</div>
							</div>
						</div>
						{{/each}}
							<table id="sensorTable">
								<tr class="control-group" id="sensor_form_{{_id}}">
									<td><input type="text" name="sensorName" id="sensor_form_name_{{_id}}" placeholder="Sensor Name"></td>
										<td>
											<select class="form-control" id="sensor_form_type_{{_id}}" name="sensorType">
											<option>Potentiometer</option>
											<option>Accelerometer</option>
											</select>
										</td>
									<td>
										<input type="text" name="pins" id="sensor_form_pins_{{_id}}" placeholder="Pins (Ex. 1 2 3)">
									</td>
									<td>
										<span id={{_id}}>
											<button id="add_sensor_{{_id}}" class="btn btn-default" style="margin-top: -10px">Add Sensor</button>
										</span>
									</td>
								</tr>
							</table>
					</div>
				</div>
			</div>
		{{/each}}
	</div>
</template>

<template name="graph">
	{{_id}}
	<script>console.log("{{_id}}");
	console.log($('#{{_id}}_data'));
	</script>
	<script>
		console.log("executed2");
	    	console.log("{{_id}}");
	    	$('#{{_id}}_data').highcharts({
		        chart: {
		            type: 'line'
		        },
		        title: {
		            text: 'Sensor Data'
		        },
		        subtitle: {
		            text: 'Subtitle'
		        },
		        yAxis: {
		            title: {
		                text: 'Sensor Value'
		            }
		        },
		        plotOptions: {
		            line: {
		                dataLabels: {
		                    enabled: true
		                },
		                enableMouseTracking: false
		            }
		        },
		        series: [{
		            name: 'Sensor Name Here',
		            data: {{data}}
		        }]
		    });
	</script>
</template>